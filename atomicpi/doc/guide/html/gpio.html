<!-- HTML header for doxygen -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen"/>
<title>DLI Atomic Pi user guide: GPIO pin reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<script type="text/javascript" src="dli_context.js"></script>
<link href="style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">DLI Atomic Pi user guide
   </div>
  </td>
 </tr>
 </tbody>
</table>
<div id="doxygendocversion">20190502T140852Z</div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('gpio.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">GPIO pin reference </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The Atomic Pi has 6 GPIO pins available to users, and additional lines connected to the BNO055 sensor. Here's a overview of them.</p>
<h1><a class="anchor" id="gpio_addressing"></a>
Addressing</h1>
<p>In order to use GPIO pins from Linux, it's important to understand how they are addressed in various situations.</p>
<p>Each GPIO has a global number in the integer GPIO namespace used with the legacy GPIO interface (e.g. through <code>sysfs</code>). This is considered a legacy interface but there are currently no plans to remove it. However, in addition to that, recent Linux kernels expose GPIO chips, which are basically named sets of GPIOs of the same hardware origin with a single base number; GPIOs are numbered sequentially within a chip, but the global GPIO namespace itself needn't be contiguous.</p>
<h1><a class="anchor" id="gpio_description"></a>
Pin description</h1>
<p>Generally available pins:</p>
<table class="doxtable">
<tr>
<th>Schematic name</th><th>GPIO chip id</th><th>Chip pin number</th><th>Global pin number</th><th>Connected devices </th></tr>
<tr>
<td>ISH_GPIO_0</td><td>gpiochip3</td><td>21</td><td>335</td><td></td></tr>
<tr>
<td>ISH_GPIO_1</td><td>gpiochip3</td><td>18</td><td>332</td><td>LED Green (active low) </td></tr>
<tr>
<td>ISH_GPIO_2</td><td>gpiochip3</td><td>24</td><td>338</td><td>LED Yellow (active low) </td></tr>
<tr>
<td>ISH_GPIO_3</td><td>gpiochip3</td><td>15</td><td>329</td><td></td></tr>
<tr>
<td>ISH_GPIO_4</td><td>gpiochip3</td><td>22</td><td>336</td><td></td></tr>
<tr>
<td>ISH_GPIO_7</td><td>gpiochip3</td><td>16</td><td>330</td><td></td></tr>
</table>
<p>These signals are available on the Atomic Pi's 26-pin connector. If you have the Enchilada breakout board, the signals are available as on it as well. Connector pin numbers are as follows:</p>
<table class="doxtable">
<tr>
<th>Schematic name</th><th>26-pin connector number</th><th>Enchilada connector number </th></tr>
<tr>
<td>ISH_GPIO_0</td><td>24</td><td>9 </td></tr>
<tr>
<td>ISH_GPIO_1</td><td>25</td><td>10 </td></tr>
<tr>
<td>ISH_GPIO_2</td><td>26</td><td>11 </td></tr>
<tr>
<td>ISH_GPIO_3</td><td>18</td><td>3 </td></tr>
<tr>
<td>ISH_GPIO_4</td><td>19</td><td>4 </td></tr>
<tr>
<td>ISH_GPIO_7</td><td>20</td><td>5 </td></tr>
</table>
<p>"Volume control button" pins (available on the "VOLUME"/"VOL" connectors, can be used as regular GPIO pins):</p>
<table class="doxtable">
<tr>
<th>Schematic name</th><th>GPIO chip id</th><th>Chip pin number</th><th>Global pin number</th><th>Description </th></tr>
<tr>
<td>GPIO_DFX_2</td><td>gpiochip1</td><td>7</td><td>348</td><td>Volume up pin </td></tr>
<tr>
<td>GPIO_DFX_4</td><td>gpiochip1</td><td>5</td><td>346</td><td>Volume down pin </td></tr>
</table>
<p>Other pins (not on the 26-pin connector or the Enchilada connector):</p>
<table class="doxtable">
<tr>
<th>Schematic name</th><th>GPIO chip id</th><th>Chip pin number</th><th>Global pin number</th><th>Connected devices </th></tr>
<tr>
<td>I2C2_3P3_SDA</td><td>gpiochip0</td><td>62</td><td>476</td><td>BNO055 I2C SDA </td></tr>
<tr>
<td>I2C2_3P3_SCL</td><td>gpiochip0</td><td>66</td><td>480</td><td>BNO055 I2C SCL </td></tr>
<tr>
<td>AU_MIC_SEL</td><td>gpiochip1</td><td>0</td><td>341</td><td>XMOS Audio microphone loopback selector </td></tr>
<tr>
<td>XMOS_RESET</td><td>gpiochip1</td><td>8</td><td>349</td><td>XMOS Audio reset (active low) </td></tr>
<tr>
<td>BN_INT</td><td>gpiochip1</td><td>17</td><td>358</td><td>BNO055-generated interrupt (active low) </td></tr>
<tr>
<td>BN_RESET</td><td>gpiochip1</td><td>25</td><td>366</td><td>BNO055 reset (active low) </td></tr>
</table>
<p>The XMOS_RESET line is controlled by a system service, <code>atomicpi-hold-xmos</code>, to bring up the XMOS Audio device.</p>
<p>The AU_MIC_SEL line must be configured to logical 0 to record audio from microphone, or to logical 1 for loopback (recording audio being played back).</p>
<p>Using the interrupt and reset lines is not strictly required for BNO055 operation. Additional devices may be connected to its I2C bus but that would require soldering.</p>
<p>Note that the system core contains other GPIO pins, some connected to internal circuits. Reading the datasheet is strongly recommended before attempting to configure them!</p>
<h1><a class="anchor" id="gpio_use_shell"></a>
Using GPIOs from the shell</h1>
<p>GPIO pin constants can be pulled in by including <code>/usr/lib/atomicpi.sh</code>: </p><pre class="fragment">. /usr/lib/atomicpi.sh
</pre><p>The traditional sysfs way of manipulating GPIOs from the command line is documented at:</p>
<p><a href="https://www.kernel.org/doc/Documentation/gpio/sysfs.txt">https://www.kernel.org/doc/Documentation/gpio/sysfs.txt</a></p>
<p>It is listed as deprecated but there are no plans to remove it. </p><pre class="fragment">. /usr/lib/atomicpi.sh
echo $ATOMICPI_ISH_GPIO_1 &gt;/sys/class/gpio/export
echo $ATOMICPI_ISH_GPIO_2 &gt;/sys/class/gpio/export
echo low &gt;/sys/class/gpio/$ATOMICPI_ISH_GPIO_1/direction
while true; do
    echo low &gt; /sys/class/gpio/$ATOMICPI_ISH_GPIO_2/direction
    sleep 1
    echo high &gt; /sys/class/gpio/$ATOMICPI_ISH_GPIO_2/direction
    sleep 1
done
echo $ATOMICPI_ISH_GPIO_2 &gt;/sys/class/gpio/unexport
echo $ATOMICPI_ISH_GPIO_1 &gt;/sys/class/gpio/unexport
</pre><p>Constants storing global GPIO indices are prefixed by <code>ATOMICPI_</code>.</p>
<p>Additionally, several utilities allow GPIO control using the more modern interface (and chip id + pin index addressing):</p>
<p>Constants storing "&lt;chip id&gt; &lt;pin index&gt;" are prefixed by <code>ATOMICPICHIP_</code>. Due to shell expansion rules, ${ATOMICPICHIP_ISH_GPIO_0} (without quotes) will expand to two arguments, the chip id and the pin index, which is what most of the following utilities expect.</p>
<p>List all GPIO chips, print their labels and number of GPIO lines: </p><pre class="fragment">gpiodetect
</pre><p>Find a GPIO line by name (the output of this command can be used as input for <code>gpioget</code>/<code>gpioset</code>): </p><pre class="fragment">gpiofind &lt;name&gt;
</pre><p>Print information about all lines of the specified GPIO chip(s) (or all chips if none are specified): </p><pre class="fragment">gpioinfo &lt;gpiochip1&gt; ...
</pre><p>Read line value(s) from a GPIO chip: </p><pre class="fragment">gpioget [-l] &lt;chip name/number&gt; &lt;offset 1&gt; &lt;offset 2&gt; ...

Options:
  -l, --active-low:     set the line active state to low
</pre><p>Set GPIO line values of a GPIO chip: </p><pre class="fragment"> gpioset [OPTIONS] &lt;chip name/number&gt; &lt;offset1&gt;=&lt;value1&gt; &lt;offset2&gt;=&lt;value2&gt; ...

 Options:
   -l, --active-low:     set the line active state to low
   -m, --mode=[exit|wait|time|signal] (defaults to 'exit'):
                 tell the program what to do after setting values
   -s, --sec=SEC:        specify the number of seconds to wait (only valid for --mode=time)
   -u, --usec=USEC:      specify the number of microseconds to wait (only valid for --mode=time)
   -b, --background:     after setting values: detach from the controlling terminal

 Modes:
   exit:         set values and exit immediately
   wait:         set values and wait for user to press ENTER
   time:         set values and sleep for a specified amount of time
   signal:       set values and wait for SIGINT or SIGTERM
</pre><p>Wait for events on GPIO lines: </p><pre class="fragment">gpiomon [OPTIONS] &lt;chip name/number&gt; &lt;offset 1&gt; &lt;offset 2&gt; ...

Options:
  -l, --active-low:     set the line active state to low
  -n, --num-events=NUM: exit after processing NUM events
  -s, --silent:         don't print event info
  -r, --rising-edge:    only process rising edge events
  -f, --falling-edge:   only process falling edge events
  -F, --format=FMT      specify custom output format

Format specifiers:
  %o:  GPIO line offset
  %e:  event type (0 - falling edge, 1 rising edge)
  %s:  seconds part of the event timestamp
  %n:  nanoseconds part of the event timestamp
</pre><p>See <code>/usr/lib/atomicpi.sh</code> for details.</p>
<h1><a class="anchor" id="gpio_use_node"></a>
Using GPIOs from Node.JS</h1>
<pre class="fragment">var atomicpi = require("atomicpi");
var GPIO = require("sysfs-gpio");
console.log("Control by signal ID");
GPIO.export(atomicpi.signals.ISH_GPIO_0.global_idx, (pin) =&gt; {
   pin.out();
   pin.high();
});
console.log("Control with signal ID lookup on Enchilada connector first");
GPIO.export(atomicpi.signals[atomicpi.connectors.enchilada.leds.green].global_idx, (pin) =&gt; {
   pin.out();
   pin.low();
});
process.stdin.resume();
</pre><p><code>atomicpi.signals</code> contains a mapping from the signal name (e.g. "ISH_GPIO_0") to <code>{chip,chip_idx,global_idx}</code>. You will need <code>global_idx</code> most of the time as <code>sysfs-gpio</code> uses the legacy <code>sysfs</code> interface.</p>
<p>See <code>/usr/lib/node/atomicpi.js</code> and <code>sysfs-gpio</code> documentation for details.</p>
<h1><a class="anchor" id="gpio_use_python"></a>
Using GPIOs from Python</h1>
<pre class="fragment">import atomicpi
import gpio as GPIO
# Control by signal ID
GPIO_0=atomicpi.signals.ISH_GPIO_0.global_idx
GPIO.setup(GPIO_0, GPIO.OUT)
GPIO.output(GPIO_0, True)
# Control with signal ID lookup on Enchilada connector first
GREEN_LED=atomicpi.signals[atomicpi.connectors.enchilada.leds.green].global_idx
GPIO.setup(GREEN_LED, GPIO.OUT)
GPIO.output(GREEN_LED, False)
GPIO.cleanup(GPIO_0)
GPIO.cleanup(GREEN_LED)
</pre><p><code>atomicpi.signals</code> contains a mapping from the signal name (e.g. "ISH_GPIO_0") to <code>{chip,chip_idx,global_idx}</code>. You will need <code>global_idx</code> most of the time as <code>gpio</code> uses the legacy <code>sysfs</code> interface.</p>
<p>The <code>gpio</code> library largely mimics the Raspberry Pi <code>RPIO</code> library.</p>
<p>See <code>/usr/lib/python/dist-packages/atomicpi.py</code> and <code>gpio</code> documentation for details. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a></li>
  </ul>
</div>
</body>
</html>
